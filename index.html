<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>古戦場効率シミュレーター</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div id="app" class="max-w-md mx-auto bg-white p-6 rounded-xl shadow-md">
        <h1 class="text-xl font-bold mb-2 text-center border-b pb-2">古戦場効率計算機</h1>
        
        <div class="flex items-center justify-center mb-6 py-2 bg-gray-50 rounded-lg border border-dashed border-gray-300">
            <input type="checkbox" id="highEarner" class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
            <label for="highEarner" class="ml-2 text-sm font-bold text-gray-700 cursor-pointer">貢献度稼げる方はこちら</label>
        </div>

        <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">目標累計貢献度</label>
                    <input type="number" id="targetContribution" value="0" step="10000000" class="w-full mt-1 p-2 border rounded-md bg-yellow-50 font-bold text-yellow-900">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">現在の累計貢献度</label>
                    <input type="number" id="currentTotal" value="0" step="10000000" class="w-full mt-1 p-2 border rounded-md bg-green-50 font-bold text-green-900">
                </div>
            </div>

            <div class="p-3 bg-gray-50 rounded border text-center">
                <p class="text-xs text-gray-500 font-bold">目標まであと</p>
                <p id="remainingGap" class="text-xl font-black text-gray-800">0</p>
                <p class="text-[10px] text-gray-400">（目標累計 - 現在累計）</p>
            </div>

            <hr>

            <div class="grid grid-cols-2 gap-4 items-end">
                <div>
                    <label class="block text-sm font-medium text-gray-700">討伐難易度</label>
                    <select id="levelSelect" class="w-full mt-1 p-2 border rounded-md bg-white font-bold text-lg">
                        <option value="0">90HELL</option>
                        <option value="1">95HELL</option>
                        <option value="2">100HELL</option>
                        <option value="3">150HELL</option>
                        <option value="4">200HELL</option>
                        <option value="5" selected>250HELL</option>
                    </select>
                </div>
                <div class="pb-1">
                    <label class="block text-[10px] font-medium text-gray-400 uppercase">獲得貢献度</label>
                    <div class="p-2 bg-gray-50 border rounded-md text-right font-bold text-gray-600">
                        <span id="selectedCont">0</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-4" id="timeInputContainer">
                <div class="p-3 bg-blue-50 rounded-lg border border-blue-100">
                    <label id="mainTimeLabel" class="block text-sm font-bold text-blue-700">250HELLのタイム (例: 330→3分30秒、010→10秒)</label>
                    <input type="text" id="timeInput" value="1000" class="w-full mt-1 p-2 border rounded-md text-xl text-center font-black tracking-widest">
                    <div id="timeInterpret" class="text-right text-xs text-blue-600 font-bold mt-1">タイム: 10分 00秒</div>
                </div>

                <div id="compare200Container" class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                    <label class="block text-sm font-bold text-gray-600">比較用: 200HELLのタイム</label>
                    <input type="text" id="timeInput200" value="300" class="w-full mt-1 p-2 border rounded-md text-xl text-center font-black tracking-widest bg-white">
                    <div id="timeInterpret200" class="text-right text-xs text-gray-500 font-bold mt-1">タイム: 3分 00秒</div>
                </div>
            </div>
        </div>

        <div id="alert250" class="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg hidden">
            <div class="flex items-center text-red-700 mb-2">
                <span class="font-bold">⚠️ その周り方、効率悪いよ！</span>
            </div>
            <div class="grid grid-cols-2 gap-2 text-center text-sm mb-2">
                <div class="p-2 bg-white rounded border border-red-100">
                    <p class="text-[10px] text-gray-400 font-bold">250HELL時速</p>
                    <p id="hourly250Result" class="font-bold text-red-600">-</p>
                </div>
                <div class="p-2 bg-white rounded border border-gray-100">
                    <p class="text-[10px] text-gray-400 font-bold">200HELL時速</p>
                    <p id="hourly200Result" class="font-bold text-green-600">-</p>
                </div>
            </div>
            <p class="text-[11px] text-red-600 leading-relaxed">
                250HELLの時速が200HELLを下回っています。<br>
                目標タイム: <span id="target250Time" class="font-bold"></span> 以内での討伐が必要です。
            </p>
        </div>

        <div id="result" class="mt-6 space-y-4">
            <div class="p-4 bg-blue-50 rounded-lg border border-blue-200 shadow-sm">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-xs text-blue-600 font-bold uppercase underline">現在の時速</p>
                    <p id="currentHourly" class="text-xl font-black text-blue-900">0 <span class="text-xs font-bold text-blue-600">/時</span></p>
                </div>
                <div class="space-y-1 text-sm pt-2 border-t border-blue-100 text-blue-800">
                    <div class="flex justify-between">
                        <span>目標までの必要周回:</span>
                        <span class="font-bold"><span id="currentNeededRuns">0</span> 回</span>
                    </div>
                    <div class="flex justify-between">
                        <span>完了までの推定時間:</span>
                        <span id="currentNeededTime" class="font-bold text-red-600">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const masterData = [
            { level: 90, contribution: 305000 },
            { level: 95, contribution: 910000 },
            { level: 100, contribution: 2680000 },
            { level: 150, contribution: 4100000 },
            { level: 200, contribution: 20000000 },
            { level: 250, contribution: 75000000 }
        ];

        function formatTime(totalMinutes) {
            if (totalMinutes <= 0) return "完了！";
            const h = Math.floor(totalMinutes / 60);
            const m = Math.ceil(totalMinutes % 60);
            return h > 0 ? `${h}時間 ${m}分` : `${m}分`;
        }

        function parseInputToSec(val) {
            if (!/^[0-9]+$/.test(val)) return null;
            let m, s;
            if (val.length <= 2) {
                m = 0; s = parseInt(val);
            } else {
                m = parseInt(val.slice(0, -2));
                s = parseInt(val.slice(-2));
            }
            if (s >= 60) return null;
            return (m * 60) + s;
        }

        function calculate() {
            const isHighEarner = document.getElementById('highEarner').checked;
            document.getElementById('targetContribution').step = isHighEarner ? 100000000 : 10000000;
            document.getElementById('currentTotal').step = isHighEarner ? 100000000 : 10000000;

            const target = parseInt(document.getElementById('targetContribution').value) || 0;
            const currentTotal = parseInt(document.getElementById('currentTotal').value) || 0;
            const remaining = Math.max(0, target - currentTotal);
            document.getElementById('remainingGap').innerText = remaining.toLocaleString();

            const idx = parseInt(document.getElementById('levelSelect').value);
            const current = masterData[idx];
            document.getElementById('selectedCont').innerText = current.contribution.toLocaleString();
            document.getElementById('mainTimeLabel').innerText = `${current.level}HELLのタイム (例: 330)`;

            // メインタイム計算
            const totalSec = parseInputToSec(document.getElementById('timeInput').value);
            if (totalSec === null) {
                document.getElementById('timeInterpret').innerText = "入力エラー";
                return;
            }
            document.getElementById('timeInterpret').innerText = `タイム: ${Math.floor(totalSec/60)}分 ${totalSec%60}秒`;

            const hourly = Math.floor(3600 / totalSec) * current.contribution;
            document.getElementById('currentHourly').innerHTML = `${hourly.toLocaleString()} <span class="text-xs font-bold">/時</span>`;

            // 250HELL比較ロジック
            const compareBox = document.getElementById('compare200Container');
            const alertBox = document.getElementById('alert250');
            
            if (current.level === 250) {
                compareBox.classList.remove('hidden');
                const sec200 = parseInputToSec(document.getElementById('timeInput200').value);
                
                if (sec200 !== null) {
                    document.getElementById('timeInterpret200').innerText = `タイム: ${Math.floor(sec200/60)}分 ${sec200%60}秒`;
                    const data200 = masterData.find(d => d.level === 200);
                    const hourly200 = Math.floor(3600 / sec200) * data200.contribution;
                    
                    // 250貢献度は200の3.75倍 (75M / 20M)
                    const limitSec = Math.floor(sec200 * 3.75);
                    
                    document.getElementById('hourly250Result').innerText = hourly.toLocaleString();
                    document.getElementById('hourly200Result').innerText = hourly200.toLocaleString();
                    document.getElementById('target250Time').innerText = `${Math.floor(limitSec/60)}分 ${limitSec%60}秒`;

                    // 時速または倍率で比較
                    if (hourly < hourly200 || totalSec > limitSec) {
                        alertBox.classList.remove('hidden');
                    } else {
                        alertBox.classList.add('hidden');
                    }
                }
            } else {
                compareBox.classList.add('hidden');
                alertBox.classList.add('hidden');
            }

            const currentRuns = Math.ceil(remaining / current.contribution);
            document.getElementById('currentNeededRuns').innerText = currentRuns.toLocaleString();
            document.getElementById('currentNeededTime').innerText = formatTime((currentRuns * totalSec) / 60);
        }

        document.getElementById('highEarner').addEventListener('change', calculate);
        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', calculate); // inputイベントに変更してリアルタイム性を向上
        });

        calculate();
    </script>
</body>

</html>

