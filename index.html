<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>古戦場効率シミュレーター</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4 pb-12">
    <div id="app" class="max-w-md mx-auto bg-white p-6 rounded-xl shadow-md">
        <h1 class="text-xl font-bold mb-2 text-center border-b pb-2">古戦場貢献度効率計算機</h1>
        
        <div class="flex items-center justify-center mb-6 py-2 bg-gray-50 rounded-lg border border-dashed border-gray-300">
            <input type="checkbox" id="highEarner" class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
            <label for="highEarner" class="ml-2 text-sm font-bold text-gray-700 cursor-pointer">貢献度稼げる方はこちら（ワンクリック一億単位になります）</label>
        </div>

        <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">目標累計貢献度</label>
                    <input type="number" id="targetContribution" value="0" step="10000000" class="w-full mt-1 p-2 border rounded-md bg-yellow-50 font-bold text-yellow-900">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">現在の累計貢献度</label>
                    <input type="number" id="currentTotal" value="0" step="10000000" class="w-full mt-1 p-2 border rounded-md bg-green-50 font-bold text-green-900">
                </div>
            </div>

            <div class="p-3 bg-gray-50 rounded border text-center">
                <p class="text-xs text-gray-500 font-bold">目標まであと</p>
                <p id="remainingGap" class="text-xl font-black text-gray-800">0</p>
            </div>

            <hr>

            <div class="grid grid-cols-2 gap-4 items-end">
                <div>
                    <label class="block text-sm font-medium text-gray-700">討伐難易度</label>
                    <select id="levelSelect" class="w-full mt-1 p-2 border rounded-md bg-white font-bold text-lg">
                        <option value="0">90HELL</option>
                        <option value="1">95HELL</option>
                        <option value="2">100HELL</option>
                        <option value="3">150HELL</option>
                        <option value="4">200HELL</option>
                        <option value="5" selected>250HELL</option>
                    </select>
                </div>
                <div class="pb-1">
                    <label class="block text-[10px] font-medium text-gray-400 uppercase">獲得貢献度</label>
                    <div class="p-2 bg-gray-50 border rounded-md text-right font-bold text-gray-600">
                        <span id="selectedCont">0</span>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                <label id="mainTimeLabel" class="block text-sm font-bold text-blue-700 mb-1"></label>
                <input type="text" id="timeInput" value="1000" class="w-full p-2 border rounded-md text-xl text-center font-black tracking-widest">
                <div id="timeInterpret" class="text-right text-xs text-blue-600 font-bold mt-1"></div>
            </div>

            <div id="compareContainer" class="hidden">
                <div class="p-4 bg-orange-50 rounded-lg border border-orange-200">
                    <div class="flex justify-between items-center mb-2">
                        <label id="compareLabel" class="text-sm font-bold text-orange-800"></label>
                        <span id="effBadge" class="text-[10px] font-bold px-2 py-0.5 rounded border"></span>
                    </div>
                    <div class="flex gap-2 items-center">
                        <input type="text" id="compareTimeInput" value="300" class="w-2/3 p-2 border border-orange-200 rounded-md text-lg text-center font-bold tracking-widest bg-white">
                        <div class="w-1/3 text-right">
                            <p class="text-[10px] text-orange-400 font-bold uppercase">比較時速</p>
                            <p id="compareHourly" class="font-bold text-orange-900 text-sm"></p>
                        </div>
                    </div>
                    <div id="compareTimeInterpret" class="text-right text-[10px] text-orange-600 italic mt-1 font-medium"></div>
                    
                    <div class="mt-3 pt-3 border-t border-orange-100 text-[11px] text-orange-800">
                        <p id="efficiencyAdvice"></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="result" class="mt-6">
            <div class="p-4 bg-gray-800 rounded-lg shadow-sm text-white">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-xs text-gray-400 font-bold uppercase underline">選択難易度の時速</p>
                    <p id="currentHourly" class="text-xl font-black">0 <span class="text-xs font-bold text-gray-400">/時</span></p>
                </div>
                <div class="space-y-1 text-sm pt-2 border-t border-gray-700">
                    <div class="flex justify-between text-gray-300">
                        <span>必要周回数:</span>
                        <span class="font-bold text-white"><span id="currentNeededRuns">0</span> 回</span>
                    </div>
                    <div class="flex justify-between text-gray-300">
                        <span>所要時間:</span>
                        <span id="currentNeededTime" class="font-bold text-orange-400">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-8 text-center text-gray-400 text-[10px]">
        <p>&copy; 2026 wakka All Rights Reserved.</p>
    </footer>

    <script>
        const masterData = [
            { level: 90, contribution: 305000 },
            { level: 95, contribution: 910000 },
            { level: 100, contribution: 2680000 },
            { level: 150, contribution: 4100000 },
            { level: 200, contribution: 20000000 },
            { level: 250, contribution: 75000000 }
        ];

        function formatTime(totalMinutes) {
            if (totalMinutes <= 0) return "目標達成";
            const h = Math.floor(totalMinutes / 60);
            const m = Math.ceil(totalMinutes % 60);
            return h > 0 ? `${h}時間 ${m}分` : `${m}分`;
        }

        function parseInputToSec(val) {
            if (!/^[0-9]+$/.test(val)) return null;
            let m, s;
            if (val.length <= 2) {
                m = 0; s = parseInt(val);
            } else {
                m = parseInt(val.slice(0, -2));
                s = parseInt(val.slice(-2));
            }
            if (s >= 60) return null;
            return (m * 60) + s;
        }

        function calculate() {
            // ステップ更新
            const isHighEarner = document.getElementById('highEarner').checked;
            document.getElementById('targetContribution').step = isHighEarner ? 100000000 : 10000000;
            document.getElementById('currentTotal').step = isHighEarner ? 100000000 : 10000000;

            const target = parseInt(document.getElementById('targetContribution').value) || 0;
            const currentTotal = parseInt(document.getElementById('currentTotal').value) || 0;
            const remaining = Math.max(0, target - currentTotal);
            document.getElementById('remainingGap').innerText = remaining.toLocaleString();

            const idx = parseInt(document.getElementById('levelSelect').value);
            const current = masterData[idx];
            document.getElementById('selectedCont').innerText = current.contribution.toLocaleString();
            document.getElementById('mainTimeLabel').innerText = `${current.level}HELLのタイム (例: 330→3分30秒、10→10秒)`;

            // メイン時速計算
            const totalSec = parseInputToSec(document.getElementById('timeInput').value);
            if (totalSec === null) {
                document.getElementById('timeInterpret').innerText = "入力エラー";
                return;
            }
            document.getElementById('timeInterpret').innerText = `タイム: ${Math.floor(totalSec/60)}分 ${totalSec%60}秒`;
            const hourly = Math.floor(3600 / totalSec) * current.contribution;
            document.getElementById('currentHourly').innerHTML = `${hourly.toLocaleString()} <span class="text-xs font-bold text-gray-400">/時</span>`;

            // 比較ロジック（一つ下の難易度がある場合のみ）
            const compareContainer = document.getElementById('compareContainer');
            if (idx > 0) {
                compareContainer.classList.remove('hidden');
                const prev = masterData[idx - 1];
                document.getElementById('compareLabel').innerText = `比較用: ${prev.level}HELLのタイム`;
                
                const compSec = parseInputToSec(document.getElementById('compareTimeInput').value);
                if (compSec !== null) {
                    document.getElementById('compareTimeInterpret').innerText = `タイム: ${Math.floor(compSec/60)}分 ${compSec%60}秒`;
                    const compHourly = Math.floor(3600 / compSec) * prev.contribution;
                    document.getElementById('compareHourly').innerText = compHourly.toLocaleString();
                    
                    const badge = document.getElementById('effBadge');
                    if (hourly >= compHourly) {
                        badge.innerText = `${current.level}の方が高効率`;
                        badge.className = "text-[10px] font-bold px-2 py-0.5 rounded border bg-green-50 border-green-200 text-green-600";
                    } else {
                        badge.innerText = `${prev.level}の方が高効率`;
                        badge.className = "text-[10px] font-bold px-2 py-0.5 rounded border bg-red-50 border-red-200 text-red-600";
                    }

                    // アドバイス（境界タイムの計算）
                    // 貢献度の比率から、現在の難易度で許容される最大秒数を算出
                    const ratio = current.contribution / prev.contribution;
                    const limitSec = Math.floor(compSec * ratio);
                    document.getElementById('efficiencyAdvice').innerHTML = 
                        `${prev.level}HELLをそのタイムで回る場合、<br><b>${current.level}HELLを ${Math.floor(limitSec/60)}分${limitSec%60}秒 以内</b>で倒せれば効率的です。`;
                }
            } else {
                compareContainer.classList.add('hidden');
            }

            // 必要周回
            const currentRuns = Math.ceil(remaining / current.contribution);
            document.getElementById('currentNeededRuns').innerText = currentRuns.toLocaleString();
            document.getElementById('currentNeededTime').innerText = formatTime((currentRuns * totalSec) / 60);
        }

        document.getElementById('highEarner').addEventListener('change', calculate);
        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', calculate);
        });

        calculate();
    </script>
</body>
</html>