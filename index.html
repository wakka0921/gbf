<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>古戦場効率シミュレーター</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div id="app" class="max-w-md mx-auto bg-white p-6 rounded-xl shadow-md">
        <h1 class="text-xl font-bold mb-6 text-center border-b pb-2">古戦場貢献度効率計算ツール</h1>

        <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">目標累計貢献度</label>
                    <input type="number" id="targetContribution" value="1000000000" step="1000000" class="w-full mt-1 p-2 border rounded-md bg-yellow-50 font-bold text-yellow-900">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">現在の累計貢献度</label>
                    <input type="number" id="currentTotal" value="0" step="1000000" class="w-full mt-1 p-2 border rounded-md bg-green-50 font-bold text-green-900">
                </div>
            </div>

            <div class="p-3 bg-gray-50 rounded border text-center">
                <p class="text-xs text-gray-500 font-bold">目標まであと</p>
                <p id="remainingGap" class="text-xl font-black text-gray-800">0</p>
                <p class="text-[10px] text-gray-400">（目標累計 - 現在累計）</p>
            </div>

            <hr>

            <div>
                <label class="block text-sm font-medium text-gray-700">現状の討伐難易度</label>
                <select id="levelSelect" class="w-full mt-1 p-2 border rounded-md bg-white font-bold">
                    <option value="0" data-cont="305000" data-ratio="1">90HELL</option>
                    <option value="1" data-cont="910000" data-ratio="3.5">95HELL</option>
                    <option value="2" data-cont="2680000" data-ratio="2.9">100HELL</option>
                    <option value="3" data-cont="4100000" data-ratio="1.5">150HELL</option>
                    <option value="4" data-cont="20000000" data-ratio="2.5">200HELL</option>
                    <option value="5" data-cont="75000000" data-ratio="3.7">250HELL</option>
                </select>
            </div>

            <div class="flex gap-4">
                <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-700">1戦のタイム（分）</label>
                    <input type="number" id="min" value="1" min="0" class="w-full mt-1 p-2 border rounded-md">
                </div>
                <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-700">1戦のタイム（秒）</label>
                    <input type="number" id="sec" value="0" min="0" max="59" class="w-full mt-1 p-2 border rounded-md">
                </div>
            </div>
        </div>

        <div id="result" class="mt-6 space-y-4">
            <div class="p-4 bg-blue-50 rounded-lg border border-blue-200 shadow-sm">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-xs text-blue-600 font-bold uppercase">現在の効率</p>
                    <p id="currentHourly" class="text-xl font-black text-blue-900">0 <span class="text-sm font-normal">/h</span></p>
                </div>
                <div class="space-y-1 text-sm pt-2 border-t border-blue-100">
                    <div class="flex justify-between">
                        <span>残り必要周回数:</span>
                        <span class="font-bold text-blue-900"><span id="currentNeededRuns">0</span> 周</span>
                    </div>
                    <div class="flex justify-between">
                        <span>推定残り時間:</span>
                        <span id="currentNeededTime" class="font-bold text-red-600 italic">0</span>
                    </div>
                </div>
            </div>

            <div id="nextLevelInfo" class="p-4 bg-orange-50 rounded-lg border-l-4 border-orange-400 hidden shadow-sm">
                <div class="flex justify-between items-center mb-2">
                    <h3 id="nextTitle" class="font-bold text-orange-800 text-sm"></h3>
                    <span class="text-[10px] bg-orange-200 text-orange-800 px-1 rounded">効率比較</span>
                </div>
                <div class="bg-white p-2 rounded border border-orange-200 mb-3">
                    <p class="text-[10px] text-gray-500 font-bold">一つ上の難易度で回る場合：</p>
                    <p class="text-sm font-bold text-orange-600"><span id="breakEven"></span> 以内で討伐</p>
                </div>
                <div class="space-y-1 text-sm">
                    <p class="text-[10px] font-bold text-orange-400 uppercase">ひとつ上の難易度で回った場合</p>
                    <div class="flex justify-between text-orange-800">
                        <span>残り必要周回数:</span>
                        <span class="font-bold"><span id="nextNeededRuns">0</span> 周</span>
                    </div>
                    <div class="flex justify-between text-orange-800">
                        <span>推定残り時間:</span>
                        <span id="nextNeededTime" class="font-bold text-green-700">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const masterData = [
            { level: 90, contribution: 305000, ratio: 1 },
            { level: 95, contribution: 910000, ratio: 3.5 },
            { level: 100, contribution: 2680000, ratio: 2.9 },
            { level: 150, contribution: 4100000, ratio: 1.5 },
            { level: 200, contribution: 20000000, ratio: 2.5 },
            { level: 250, contribution: 75000000, ratio: 3.7 }
        ];

        // 時間表示を整形する関数
        function formatTime(totalMinutes) {
            if (totalMinutes <= 0) return "完了！";
            const h = Math.floor(totalMinutes / 60);
            const m = Math.ceil(totalMinutes % 60);
            return h > 0 ? `${h}時間 ${m}分` : `${m}分`;
        }

        function calculate() {
            // 1. 貢献度の差分（残り）を計算
            const target = parseInt(document.getElementById('targetContribution').value) || 0;
            const currentTotal = parseInt(document.getElementById('currentTotal').value) || 0;
            const remaining = Math.max(0, target - currentTotal);
            
            document.getElementById('remainingGap').innerText = remaining.toLocaleString();

            // 2. 入力されたタイムを秒に変換
            const idx = parseInt(document.getElementById('levelSelect').value);
            const m = parseInt(document.getElementById('min').value) || 0;
            const s = parseInt(document.getElementById('sec').value) || 0;
            const totalSec = (m * 60) + s;

            if (totalSec <= 0) return;

            const current = masterData[idx];

            // 3. 現状の時速・周回・時間を計算
            // 時速（1時間＝3600秒の中に収まる周回数で計算）
            const completionsPerHour = Math.floor(3600 / totalSec);
            const hourly = completionsPerHour * current.contribution;
            document.getElementById('currentHourly').innerText = hourly.toLocaleString();

            // 必要周回数（残り貢献度 ÷ 1戦の貢献度 を切り上げ）
            const currentRuns = Math.ceil(remaining / current.contribution);
            document.getElementById('currentNeededRuns').innerText = currentRuns.toLocaleString();

            // 必要時間（周回数 × 1戦の秒数）
            document.getElementById('currentNeededTime').innerText = formatTime((currentRuns * totalSec) / 60);

            // 4. 次の難易度との比較
            const next = masterData[idx + 1];
            const nextArea = document.getElementById('nextLevelInfo');

            if (next) {
                nextArea.classList.remove('hidden');
                document.getElementById('nextTitle').innerText = `${next.level}HELL との比較`;

                // 損益分岐点（境界線）タイムの計算
                let beSec = 0;
                for (let x = 1; x < 3600; x++) {
                    if (Math.floor(3600 / x) * next.contribution >= hourly) {
                        beSec = x;
                    } else {
                        break;
                    }
                }
                document.getElementById('breakEven').innerText = `${Math.floor(beSec / 60)}分${beSec % 60}秒`;

                if (beSec > 0) {
                    // 次レベルでの周回数と時間を計算
                    const nextRuns = Math.ceil(remaining / next.contribution);
                    document.getElementById('nextNeededRuns').innerText = nextRuns.toLocaleString();
                    document.getElementById('nextNeededTime').innerText = formatTime((nextRuns * beSec) / 60);
                }
            } else {
                nextArea.classList.add('hidden');
            }
        }

        // 入力が変わるたびに自動実行
        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', calculate);
        });

        // 初期表示
        calculate();
    </script>
</body>
</html>